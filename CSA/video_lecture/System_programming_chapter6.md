# System Programming Chatper6 : 커널 오브젝트와 오브젝트 핸들
### 1. 커널 오브젝트에 대한 이해
- 커널 오브젝트
	> 커널 = OS(운영체제)
	>> 시대가 흐름에 따라 운영체제가 다루는 영역이 넓어졌고, 커널은 운영체제가 공통적으로 가지는 핵심기능을 의미하는 표현으로 축소되었다
	- 커널에 의해 관리되는 리소스 정보를 담고 있는 데이터 블록
		> 리소스 : 커널에 의해서 생성 및 소멸되는 것
		>> 리소스에 따라 각 커널 오브젝트는 다른 형태를 가짐
	- 프로세스 기반 커널 오브젝트
		1. CreateProcess 함수 호출 --> OS에 프로세스 생성 요청
		1. OS는 프로세스 생성
		1. 동시에 프로세스 정보를 담고 있는 커널 오브젝트 생성(사전에 정의 되어있는 프로세스 관리 구조체를 기반으로)
- 커널 오브젝트와 핸들의 관계
	- 커널 오브젝트는 개발자들이 '직접적'으로 접근할 수 없음(OS에 의해서 관리되어짐)
		> 대신 '간접적'으로 접근할 수 있는 기능을 제공하는 시스템 함수들이 제공되어짐
		>> 이때, 함수로 접근하기 위해서는 각 커널 오브젝트를 구분할 수 있는 식별자 정보가 제공되어야 함
		>>> 즉, 커널 오브젝트의 고유한 식별 번호를 '핸들'이라고 함
	- 커널 오브젝트(구조체 변수), 핸들 정보(인트형 숫자)
### 2. 커널 오브젝트와 핸들의 종속관계
- 커널 오브젝트와 핸들의 관계 예시
	1. 프로세스 A의 생성 --> 프로세스 A의 커널 오브젝트 생성 --> 프로세스 A의 핸들 테이블 생성
		```
		A 핸들 테이블
		핸들	|대상
		=====================
		3	|A 커널 오브젝트

		// UC(usage counter) : 커널 오브젝트에 접근 가능한 프로세수 수
		프로세스 A커널 오브젝트 UC : 2(프로세스 A, 프로세스 A의 부모 프로세스)
		```
	1. 프로세스 A에 의해 자녀 프로세스 B의 생성 --> 프로세스 B의 커널 오브젝트 생성 --> 프로세스 B의 핸들 테이블 생성 --> A핸들 테이블에 B커널 오브젝트 핸들정보 추가
		> 핸들 정보는 프로세스에 종속적임 즉, 각 커널 오브젝트가 하나로 정의되는 고유한 핸들정보를 가지는 것이 아니라 프로세스 별로 종속된 핸들 테이블에 서로 다르게 매핑될 수 있음
		>> 부모 프로세스는 자식 프로세스에 접근 가능하도록 핸들정보를 가짐
		```
		A 핸들 테이블			B핸들 테이블
		핸들	|대상			핸들	|대상
		=====================		=====================
		3	|A 커널 오브젝트		3	|B 커널 오브젝트
		7	|B 커널 오브젝트

		프로세스 A커널 오브젝트 UC : 2(프로세스 A, 프로세스 A의 부모 프로세스)
		프로세스 B커널 오브젝트 UC : 2(프로세스 B, 프로세스 A)
		```
	1. 프로세스 B에 의해서 파일 생성 --> 파일의 커널 오브젝트 생성 --> B핸들 테이블에 파일 커널 오브젝트 핸들정보 추가
		```
		A 핸들 테이블			B핸들 테이블
		핸들	|대상			핸들	|대상
		=====================		=====================
		3	|A 커널 오브젝트		3	|B 커널 오브젝트
		7	|B 커널 오브젝트		4	|파일 커널 오브젝트

		프로세스 A커널 오브젝트 UC : 2(프로세스 A, 프로세스 A의 부모 프로세스)
		프로세스 B커널 오브젝트 UC : 2(프로세스 B, 프로세스 A)
		파일 커널 오브젝트 UC : 1(프로세스 B)
		```
	- 위의 경우에서 프로세스 B가 종료되더라도 B커널 오브젝트의 UC는 1감소하여 1이 되고 B커널 오브젝트는 제거되지 않음
		> 프로세스 A까지 종료되어 B커널 오브젝트의 UC가 0이 되었을 때, 즉 더이상 참조하는 프로세스가 없을 때 운영체제에 의해서 제거됨
		>> 프로세스 A가 동작하는 과정에서 B프로세스가 정상 종료되었는지 여부를 B커널 오브젝트 내부 정보를 통해서 식별하기 때문에 유지되는것!
	- 위의 임의의 예시와는 다르게 실제로 현재 동작하는 프로세스가 자신의 핸들정보를 얻을 때는 테이블상에 별도로 작성되는 것이 아니라 자기자신을 의미하는 고유한 상수값(사전에 정의되어 있는)을 얻게됨
